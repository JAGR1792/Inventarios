<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Inventarios POS</title>
    <link rel="stylesheet" href="styles.css" />
    <script>
      // Legacy single-page entry point. Redirect to the new multi-page UI.
      window.location.replace('store.html')
    </script>
    <script defer src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script defer src="app.js"></script>
  </head>
  <body>
    <div class="app">
      <header class="topbar">
        <div class="brand">
          <div class="logo">IP</div>
          <div>
            <div class="name" id="appName">Inventarios POS</div>
            <div class="sub" id="appSub">Modo tienda + caja</div>
          </div>
        </div>

        <nav class="tabs" role="tablist">
          <button class="tab active" id="tabStore" data-tab="store" role="tab">Tienda</button>
          <button class="tab" id="tabSummary" data-tab="summary" role="tab">Resumen del d√≠a</button>
        </nav>

        <div class="actions">
          <button class="btn" id="btnImport">Importar Excel</button>
          <button class="btn ghost" id="btnOpenImages" title="Abrir carpeta donde se guardan las fotos">Im√°genes</button>
          <button class="btn danger" id="btnReset">Reiniciar DB</button>
        </div>
      </header>

      <main class="shell">
        <section class="main">
          <section class="panel" id="viewStore">
          <div class="toolbar">
            <div class="toolbarRow">
              <div class="search">
                <input id="storeSearch" type="text" placeholder="Buscar producto (F2)" autocomplete="off" />
                <div class="hint">Enter agrega el primero ‚Ä¢ F4 cobrar</div>
              </div>
              <div class="filters">
                <label class="field">
                  <span>Categor√≠a</span>
                  <select id="storeCategory"></select>
                </label>
              </div>
            </div>
          </div>
          <div class="grid" id="storeGrid"></div>
          </section>

          <section class="panel" id="viewSummary" hidden>
            <div class="summary2">
              <div class="kpi">
                <div class="kpiLabel">Total vendido (hist√≥rico)</div>
                <div class="kpiValue" id="kpiTotal">$0,00</div>
              </div>

              <div class="card">
                <div class="cardTitle">√öltimas ventas</div>
                <div class="tableWrap">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Fecha</th>
                        <th>M√©todo</th>
                        <th class="right">Total</th>
                        <th class="right">Items</th>
                      </tr>
                    </thead>
                    <tbody id="salesRows"></tbody>
                  </table>
                </div>
              </div>

              <div class="card">
                <div class="cardTitle">Cierres guardados</div>
                <div class="tableWrap">
                  <table class="table">
                    <thead>
                      <tr>
                        <th>Creado</th>
                        <th>D√≠a</th>
                        <th class="right">Efectivo inicio</th>
                        <th class="right">Retiros</th>
                        <th class="right">Efectivo esperado</th>
                        <th class="right">Para ma√±ana</th>
                      </tr>
                    </thead>
                    <tbody id="closesRows"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </section>
        </section>

        <aside class="sidebar" id="cashier">
          <div class="card sidebarCard">
            <div class="cartHeader">
              <div class="cartTitle">Caja</div>
              <button class="btn ghost" id="btnClear">Vaciar</button>
            </div>
            <div class="cartItems" id="cartItems"></div>
            <div class="cartFooter">
              <div class="totalRow">
                <div>Total</div>
                <div class="total" id="cartTotal">$0,00</div>
              </div>
              <button class="btn primary" id="btnCheckout">Cobrar (F4)</button>
              <div class="error" id="errorBox" hidden></div>
            </div>
          </div>

          <div class="card sidebarCard">
            <div class="cardTitle">Cierre de caja (d√≠a)</div>
            <div class="closeGrid">
              <label class="field">
                <span>D√≠a</span>
                <input id="cashDay" type="date" />
              </label>
              <label class="field">
                <span>Efectivo al iniciar</span>
                <input id="openingCash" type="number" inputmode="decimal" placeholder="0" />
              </label>
              <div class="rowBtns span2">
                <button class="btn" id="btnSaveOpening">Guardar apertura</button>
                <button class="btn" id="btnRefreshCash">Actualizar</button>
              </div>
            </div>

            <div class="closeGrid">
              <label class="field">
                <span>Retiro (dinero que se sac√≥)</span>
                <input id="withdrawAmount" type="number" inputmode="decimal" placeholder="0" />
              </label>
              <label class="field">
                <span>Nota (opcional)</span>
                <input id="withdrawNotes" type="text" placeholder="Ej: compra proveedor" />
              </label>
              <div class="rowBtns span2">
                <button class="btn" id="btnAddWithdraw">Agregar retiro</button>
              </div>
            </div>

            <div class="miniList" id="withdrawList"></div>

            <div class="closeTotals">
              <div><span>Total d√≠a</span><b id="cashGross">$0,00</b></div>
              <div><span>Efectivo (ventas)</span><b id="cashCash">$0,00</b></div>
              <div><span>Tarjeta</span><b id="cashCard">$0,00</b></div>
              <div><span>Nequi</span><b id="cashNequi">$0,00</b></div>
              <div><span>Virtual</span><b id="cashVirtual">$0,00</b></div>
              <div><span># Ventas</span><b id="cashCount">0</b></div>
              <div><span>Retiros</span><b id="cashWithdrawals">$0,00</b></div>
              <div><span>Efectivo esperado en caja</span><b id="cashExpected">$0,00</b></div>
            </div>

            <div class="closeGrid">
              <label class="field">
                <span>Efectivo contado (opcional)</span>
                <input id="cashCounted" type="number" inputmode="decimal" placeholder="0" />
              </label>
              <label class="field">
                <span>Dejar para ma√±ana</span>
                <input id="carryNext" type="number" inputmode="decimal" placeholder="0" />
              </label>
              <label class="field span2">
                <span>Notas (opcional)</span>
                <input id="cashNotes" type="text" placeholder="Ej: turno ma√±ana" />
              </label>
            </div>

            <div class="rowBtns">
              <button class="btn primary" id="btnCloseDay">Guardar cierre</button>
            </div>
            <div class="error" id="cashError" hidden></div>
            <div class="hint" id="cashOk" hidden></div>
          </div>
        </aside>
      </main>

      <div class="toast" id="toast" hidden></div>

      <div class="modal" id="productModal" hidden>
        <div class="modalCard">
          <div class="modalTitle" id="pmTitle">Producto</div>
          <div class="productModalBody">
            <div class="pmThumb" id="pmThumb">üì¶</div>
            <div class="flex1">
              <div class="modalText" id="pmDesc"></div>
              <div class="pmMeta">
                <div>Stock: <span class="stock" id="pmStock">0</span></div>
                <div class="pmPrice" id="pmPrice">$0,00</div>
              </div>

              <label class="field mt10">
                <span>Categor√≠a</span>
                <input id="pmCategory" type="text" placeholder="Ej: Bebidas" />
              </label>

              <div class="pmQty">
                <button class="btn" id="pmDec">-</button>
                <input id="pmQty" type="number" value="1" min="1" />
                <button class="btn" id="pmInc">+</button>
              </div>
            </div>
          </div>
          <div class="modalActions">
            <button class="btn" id="pmCancel">Cerrar (Esc)</button>
            <button class="btn" id="pmSaveCat">Guardar categor√≠a</button>
            <button class="btn" id="pmPickImg">Cambiar imagen</button>
            <button class="btn ghost" id="pmClearImg">Quitar imagen</button>
            <button class="btn primary" id="pmAdd">Agregar</button>
          </div>
          <div class="error" id="pmError" hidden></div>
        </div>
      </div>

      <div class="modal" id="payModal" hidden>
        <div class="modalCard">
          <div class="modalTitle">Cobrar</div>
          <div class="modalText">Selecciona m√©todo de pago y confirma.</div>
          <div class="payGrid">
            <div class="payRow">
              <label class="radio">
                <input type="radio" name="payMethod" value="cash" checked />
                <span>Efectivo</span>
              </label>
              <label class="radio">
                <input type="radio" name="payMethod" value="card" />
                <span>Tarjeta</span>
              </label>
              <label class="radio">
                <input type="radio" name="payMethod" value="nequi" />
                <span>Nequi</span>
              </label>
              <label class="radio">
                <input type="radio" name="payMethod" value="virtual" />
                <span>Virtual</span>
              </label>
            </div>
            <label class="field" id="cashBox">
              <span>Recibido</span>
              <input id="cashReceived" type="number" inputmode="decimal" placeholder="0" />
            </label>
            <div class="closeTotals mt0">
              <div><span>Total</span><b id="payTotal">$0,00</b></div>
              <div><span>Cambio</span><b id="payChange">$0,00</b></div>
            </div>
          </div>
          <div class="modalActions">
            <button class="btn" id="payCancel">Cancelar (Esc)</button>
            <button class="btn primary" id="payConfirm">Confirmar</button>
          </div>
          <div class="error" id="payError" hidden></div>
        </div>
      </div>

      <div class="modal" id="modal" hidden>
        <div class="modalCard">
          <div class="modalTitle">Reiniciar base de datos</div>
          <div class="modalText">
            Esto borra ventas y movimientos de caja, y pone el stock en 0.
            <br />
            <b>Las im√°genes NO se borran</b> (ni archivos ni mapeos).
            <br />
            Escribe <b>BORRAR</b> para confirmar.
          </div>
          <input id="confirmText" class="modalInput" placeholder="BORRAR" />
          <div class="modalActions">
            <button class="btn" id="btnCancel">Cancelar</button>
            <button class="btn danger" id="btnConfirm">Borrar todo</button>
          </div>
          <div class="error" id="modalError" hidden></div>
        </div>
      </div>
    </div>
  </body>
</html>
